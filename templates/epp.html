<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Entrega EPP RMC</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* 1. RESERVAMOS ESPACIO EN LOS MÁRGENES */
        @page { 
            size: A4; 
            margin-left: 1cm; 
            margin-right: 1cm;
            margin-top: 1cm; 
            margin-bottom: 3.5cm; /* Espacio suficiente para que el footer no se solape con la tabla */
        }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            font-size: 10pt; 
            color: #333; 
        }
        
        /* 2. DEFINIMOS EL FOOTER FIJO */
        .footer-fixed {
            position: fixed; 
            bottom: -3cm; /* Lo bajamos dentro del margen reservado */
            left: 0; 
            right: 0; 
            height: 2.5cm;
            text-align: center; 
            font-size: 8pt; 
            color: #777;
            /* Fondo blanco para tapar líneas de tabla si llegaran a pasar por debajo */
            background-color: white; 
            padding-top: 5px;
            border-top: 1px solid #ccc;
        }

        /* Estilos generales */
        .top-header-table { width: 100%; margin-bottom: 20px; }
        .logo-img { width: 140px; float: right; }
        .main-title { text-align: center; color: #004B8D; font-size: 16pt; font-weight: bold; margin-bottom: 5px; }
        
        .legal-box { 
            border: 1px solid #ccc; background-color: #f9f9f9; padding: 10px; 
            font-size: 9pt; font-style: italic; text-align: justify; margin-bottom: 20px; 
        }

        .info-table { width: 100%; border-collapse: collapse; border: 1px solid #999; margin-bottom: 20px; }
        .info-table td { padding: 8px; border: 1px solid #ccc; }
        .label-cell { background-color: #f2f2f2; font-weight: bold; width: 15%; }
        
        /* Tabla EPP */
        .epp-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .epp-table th { background-color: #004B8D; color: white; padding: 8px; border: 1px solid #000; }
        .epp-table td { border: 1px solid #ccc; padding: 6px; text-align: center; }
        
        /* Para que el encabezado de la tabla se repita si salta de página */
        thead { display: table-header-group; }
        tr { page-break-inside: avoid; }

        /* Estilos del Footer internos */
        .footer-company { font-weight: bold; color: #333; font-size: 9pt; margin-bottom: 2px; }
        .footer-link { color: #004B8D; font-weight: bold; text-decoration: none; }

        /* Bloque de firma */
        .signature-block {
            margin-top: 50px; 
            text-align: center;
            page-break-inside: avoid; /* Evita que la firma quede partida entre dos páginas */
        }
    </style>
</head>
<body>

    <div class="footer-fixed">
        <div class="footer-company">RMC CORPORATE</div>
        <div>Bellavista 05, Edificio Olimpo, Of. 307, Viña del Mar | Teléfono: (32) 260 0305</div>
        <div>
            Sitio Web: <span class="footer-link">www.rmccorporate.com</span> | 
            Linkedin & YouTube: <span class="footer-link">RMC Corporate</span> | 
            Correo: <span class="footer-link">contacto@rmc.cl</span>
        </div>
    </div>

    <table class="top-header-table">
        <tr>
            <td>
                <div style="font-size: 8pt;">
                    <strong>CÓDIGO:</strong> 99200-SIGOP-R6506<br>
                    <strong>REV:</strong> 11/06/25
                </div>
            </td>
            <td><img src="{{ logo_b64 }}" class="logo-img"></td>
        </tr>
    </table>

    <div class="main-title">ENTREGA DE EPP</div>
    
    <div class="legal-box">
        "De acuerdo a lo estipulado en la Ley 16.744, Art. 68 inciso tres: Las empresas deberán proporcionar a sus trabajadores, los equipos e implementos de protección necesarios, no pudiendo en caso alguno cobrarles su valor."
    </div>

    <table class="info-table">
        <tr>
            <td class="label-cell">NOMBRE:</td>
            <td>{{ nombre }}</td>
            <td class="label-cell">RUT:</td>
            <td>{{ rut }}</td>
        </tr>
        <tr>
            <td class="label-cell">CARGO:</td>
            <td>{{ cargo }}</td>
            <td class="label-cell">FECHA:</td>
            <td>{{ fecha }}</td>
        </tr>
    </table>

    <table class="epp-table">
        <thead>
            <tr>
                <th style="width: 40%;">EPP / ROPA CORPORATIVA</th>
                <th style="width: 15%;">TALLA</th>
                <th style="width: 15%;">CANT.</th>
                <th style="width: 15%;">TIPO</th>
                <th style="width: 15%;">FIRMA</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td style="text-align: left;">{{ item['EPP/ROPA'] }}</td>
                <td>{{ item.TALLA }}</td>
                <td>{{ item.CANT }}</td>
                <td>{% if item.REPOSICIÓN %}Reposición{% else %}Nuevo{% endif %}</td>
                <td>OK</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="signature-block">
        <p style="font-size: 9pt;">El trabajador se compromete a mantener los elementos de protección personal en buen estado y declara haberlos recibido en forma gratuita.</p>
        
        {% if firma_b64 %}
            <img src="{{ firma_b64 }}" style="height: 60px; border-bottom: 1px solid black; margin-top: 20px;">
        {% else %}
            <br><br><br><br><hr style="width: 40%;">
        {% endif %}
        <p><b>FIRMA DEL TRABAJADOR</b><br>{{ nombre }}</p>
    </div>

</body>
</html>